; Not licensed by Nintendo
;
; Copyright (c) 2025 Dmitry Shechtman

include "color.inc"


DEF INTRO_SGB_DELAY      EQU $80

DEF INTRO_REG_START      EQU  64
DEF INTRO_REG_DROP_START EQU  72

DEF B_INTRO_REG_LENGTH   EQU   2
DEF INTRO_REG_LENGTH     EQU   1 << B_INTRO_REG_LENGTH
DEF INTRO_REG_MASK       EQU INTRO_REG_LENGTH - 1

IF !DEF(INTRO_SONG_DELAY)
	DEF INTRO_SONG_DELAY EQU   0
ENDC

DEF INTRO_TOP_SLIM_WIDTH EQU   3
DEF INTRO_TOP_NORM_WIDTH EQU   6

DEF INTRO_N0_WIDTH       EQU   2
DEF INTRO_I_WIDTH        EQU   1
DEF INTRO_N1_WIDTH       EQU   2
DEF INTRO_T_WIDTH        EQU   1
DEF INTRO_D_WIDTH        EQU   2
DEF INTRO_O_WIDTH        EQU   2

DEF MAP_LOGO             EQU TILEMAP0
DEF COL_LOGO             EQU   4
DEF ROW_LOGO             EQU   8

DEF MAP_LOGO2            EQU TILEMAP1
DEF ROW_LOGO2            EQU   0
DEF COL_LOGO2            EQU COL_LOGO

DEF MAP_INTRO_TOP        EQU TILEMAP0
DEF ROW_INTRO_TOP        EQU   7
DEF COL_INTRO_TOP        EQU   0

DEF MAP_INTRO_O          EQU MAP_INTRO_TOP
DEF ROW_INTRO_O          EQU ROW_INTRO_TOP
DEF COL_INTRO_O          EQU   5

DEF MAP_INTRO_BY         EQU MAP_INTRO_TOP
DEF ROW_INTRO_BY         EQU ROW_INTRO_TOP
DEF COL_INTRO_BY         EQU  13

DEF MAP_INTRO_E          EQU TILEMAP0
DEF ROW_INTRO_E          EQU   8
DEF COL_INTRO_E          EQU   9

DEF MAP_INTRO_N2         EQU TILEMAP1
DEF ROW_INTRO_N2         EQU   0
DEF COL_INTRO_N2         EQU   0

DEF Y_INTRO_N2           EQU  64
DEF X_INTRO_N2           EQU  86 + WX_OFS

DEF Y_INTRO_REG          EQU  80
DEF X_INTRO_REG          EQU 136

DEF Y_INTRO_INIT         EQU   0
DEF Y_INTRO_FINAL        EQU  72
DEF Y_INTRO_TOP          EQU  64
DEF Y_INTRO_BOTTOM       EQU  80

DEF X_INTRO_TOP_0        EQU  48
DEF X_INTRO_TOP_1        EQU X_INTRO_TOP_0 + 12
DEF X_INTRO_TOP_2        EQU X_INTRO_TOP_1 + 10
DEF X_INTRO_TOP_3        EQU X_INTRO_TOP_2 + INTRO_TOP_SLIM_WIDTH
DEF X_INTRO_TOP_4        EQU X_INTRO_TOP_3 + INTRO_TOP_SLIM_WIDTH
DEF X_INTRO_TOP_5        EQU X_INTRO_TOP_4 + INTRO_TOP_NORM_WIDTH
DEF X_INTRO_TOP_6        EQU X_INTRO_TOP_5 + INTRO_TOP_NORM_WIDTH
DEF X_INTRO_TOP_7        EQU X_INTRO_TOP_6 + INTRO_TOP_NORM_WIDTH
IF DEF(EN_GB)
    DEF X_INTRO_TOP_8    EQU X_INTRO_TOP_7 + INTRO_TOP_NORM_WIDTH
ELSE
    DEF X_INTRO_TOP_8    EQU X_INTRO_TOP_7 + INTRO_TOP_NORM_WIDTH - 1
ENDC
DEF X_INTRO_TOP_9        EQU X_INTRO_TOP_8 + INTRO_TOP_NORM_WIDTH

DEF X_INTRO_N0           EQU  39
DEF X_INTRO_I            EQU  54
DEF X_INTRO_N1           EQU  60
DEF X_INTRO_T            EQU  74
DEF X_INTRO_D            EQU 108
DEF X_INTRO_O            EQU 122

DEF T_LOGO               EQU $01
DEF T_REG                EQU $19
DEF T_INTRO_NOT_2        EQU T_REG             +  1
DEF T_INTRO_BY           EQU T_INTRO_NOT_2     +  2
DEF T_INTRO_TOP_2_2      EQU T_INTRO_BY        +  1
DEF T_INTRO_BY_1         EQU T_INTRO_TOP_2_2   +  1

DEF T_INTRO_TOP_0        EQU $20
DEF T_INTRO_TOP_1        EQU T_INTRO_TOP_0     +  1
DEF T_INTRO_TOP_2        EQU T_INTRO_TOP_1     +  1
DEF T_INTRO_TOP_3        EQU T_INTRO_TOP_2     +  1
DEF T_INTRO_TOP_4        EQU T_INTRO_TOP_3     +  1
DEF T_INTRO_TOP_5        EQU T_INTRO_TOP_4     +  1
DEF T_INTRO_TOP_6        EQU T_INTRO_TOP_5     +  1
IF DEF(EN_GB)
    DEF T_INTRO_TOP_7    EQU T_INTRO_TOP_4
ELSE
    DEF T_INTRO_TOP_7    EQU T_INTRO_TOP_6     +  1
ENDC
DEF T_INTRO_TOP_8        EQU T_INTRO_TOP_5
DEF T_INTRO_TOP_9        EQU T_INTRO_TOP_6     +  2
DEF T_INTRO_REG          EQU T_INTRO_TOP_9     +  1

DEF T_INTRO_TOP_O        EQU $30
DEF T_INTRO_N            EQU T_INTRO_TOP_O     + 16
DEF T_INTRO_E            EQU T_INTRO_N         + 32
DEF T_INTRO_N0           EQU T_INTRO_E         + 32
DEF T_INTRO_D            EQU T_INTRO_N0        + 16
DEF T_INTRO_O            EQU T_INTRO_D         + 16
DEF T_INTRO_I            EQU T_INTRO_O         + 16
DEF T_INTRO_T            EQU T_INTRO_I         +  8

DEF T_INTRO_N1           EQU T_INTRO_N
DEF T_INTRO_N2           EQU T_INTRO_N

MACRO DEF_INTRO
	DEF T_INTRO_\1       EQU T_INTRO_\2
	DEF X_INTRO_\1       EQU X_INTRO_\2
	DEF INTRO_\1_WIDTH   EQU INTRO_\2_WIDTH
ENDM

DEF_INTRO 0, N0
DEF_INTRO 1, N1
DEF_INTRO 2, D
DEF_INTRO 3, O
DEF_INTRO 4, I
DEF_INTRO 5, T

DEF COLOR8_STEP          EQU 64

IF !DEF(C_INTRO_BACK)
	DEF C_INTRO_BACK     EQU C_WHITE
ENDC

IF !DEF(C_INTRO_BACK_SGB)
	DEF C_INTRO_BACK_SGB     EQU C_INTRO_BACK
ENDC

IF !DEF(C_INTRO_TOP)
	DEF C_INTRO_TOP          EQU C_BLACK
ENDC

IF !DEF(C_INTRO_TOP_0)
	IF DEF(COLOR8)
		DEF C_INTRO_TOP_0    EQU C_DARK_RED
	ELSE
		DEF C_INTRO_TOP_0    EQU C_INTRO_TOP
	ENDC
ENDC

IF !DEF(C_INTRO_TOP_O)
	IF DEF(COLOR8)
		DEF C_INTRO_TOP_O    EQU C_MID_RED
	ELSE
		DEF C_INTRO_TOP_O    EQU C_INTRO_TOP
	ENDC
ENDC

IF !DEF(C_INTRO_TOP_1)
	IF DEF(COLOR8)
		DEF C_INTRO_TOP_1    EQU C_RED
	ELSE
		DEF C_INTRO_TOP_1    EQU C_INTRO_TOP
	ENDC
ENDC

IF !DEF(C_INTRO_TOP_2)
	IF DEF(COLOR8)
		DEF C_INTRO_TOP_2 EQU C_ORANGE
	ELSE
		DEF C_INTRO_TOP_2 EQU C_INTRO_TOP
	ENDC
ENDC

IF !DEF(C_INTRO_TOP_3)
	IF DEF(COLOR8)
		DEF C_INTRO_TOP_3 EQU C_YELLOW
	ELSE
		DEF C_INTRO_TOP_3 EQU C_INTRO_TOP
	ENDC
ENDC

IF !DEF(C_INTRO_TOP_4)
	IF DEF(COLOR8)
		DEF C_INTRO_TOP_4 EQU C_OCHRE
	ELSE
		DEF C_INTRO_TOP_4 EQU C_INTRO_TOP
	ENDC
ENDC

IF !DEF(C_INTRO_TOP_5)
	IF DEF(COLOR8)
		DEF C_INTRO_TOP_5 EQU C_GREEN
	ELSE
		DEF C_INTRO_TOP_5 EQU C_INTRO_TOP
	ENDC
ENDC

IF !DEF(C_INTRO_TOP_6)
	IF DEF(COLOR8)
		DEF C_INTRO_TOP_6 EQU C_DARK_CYAN
	ELSE
		DEF C_INTRO_TOP_6 EQU C_INTRO_TOP
	ENDC
ENDC

IF !DEF(C_INTRO_TOP_7)
	IF DEF(COLOR8)
		DEF C_INTRO_TOP_7 EQU C_BLUE
	ELSE
		DEF C_INTRO_TOP_7 EQU C_INTRO_TOP
	ENDC
ENDC

IF !DEF(C_INTRO_TOP_8)
	IF DEF(COLOR8)
		DEF C_INTRO_TOP_8 EQU C_MAGENTA
	ELSE
		DEF C_INTRO_TOP_8 EQU C_INTRO_TOP
	ENDC
ENDC

IF !DEF(C_INTRO_TOP_9)
	IF DEF(COLOR8)
		DEF C_INTRO_TOP_9 EQU C_PURPLE
	ELSE
		DEF C_INTRO_TOP_9 EQU C_INTRO_TOP
	ENDC
ENDC

IF !DEF(C_INTRO_BY)
	DEF C_INTRO_BY       EQU C_INTRO_TOP
ENDC

IF !DEF(C_INTRO_BY1)
	IF DEF(COLOR8)
		DEF C_INTRO_BY1      EQU C_DARK_PURPLE
	ELSE
		DEF C_INTRO_BY1      EQU C_INTRO_BY
	ENDC
ENDC

IF !DEF(C_INTRO_BY2)
	IF DEF(COLOR8)
		DEF C_INTRO_BY2      EQU C_VIOLET
	ELSE
		DEF C_INTRO_BY2      EQU C_INTRO_BY
	ENDC
ENDC

IF !DEF(C_INTRO_BOTTOM)
	DEF C_INTRO_BOTTOM   EQU C_BLACK
ENDC

IF !DEF(C_INTRO_BOTTOM_SGB)
	DEF C_INTRO_BOTTOM_SGB   EQU C_INTRO_BOTTOM
ENDC

IF DEF(INTRO_FADEOUT_DMG) && !DEF(INTRO_FADEOUT)
	DEF INTRO_FADEOUT        EQUS ""
ENDC

IF !DEF(C_INTRO_FADEOUT)
	DEF C_INTRO_FADEOUT      EQU C_INTRO_BACK
ENDC

IF !DEF(C_INTRO_FADEOUT_SGB)
	DEF C_INTRO_FADEOUT_SGB  EQU C_INTRO_BACK_SGB
ENDC

IF !DEF(INTRO_FADEOUT_START)
	DEF INTRO_FADEOUT_START  EQU 64
ENDC

IF !DEF(INTRO_FADEOUT_LENGTH)
	DEF INTRO_FADEOUT_LENGTH EQU 32
ENDC

IF INTRO_FADEOUT_START + INTRO_FADEOUT_LENGTH < 128
	DEF INTRO_FADEOUT_PADDING EQU (128 - (INTRO_FADEOUT_START + INTRO_FADEOUT_LENGTH)) * 2
ELSE
	DEF INTRO_FADEOUT_PADDING EQU 0
ENDC

IF !DEF(INTRO_FADEOUT_MIDDLE)
	DEF INTRO_FADEOUT_MIDDLE EQU (INTRO_FADEOUT_START + 128) / 2
ENDC

IF !DEF(INTRO_FADEOUT_DMG_P1)
	DEF INTRO_FADEOUT_DMG_P1 EQU %00_00_10_00
ENDC

IF !DEF(INTRO_FADEOUT_DMG_P2)
	DEF INTRO_FADEOUT_DMG_P2 EQU %00_00_01_00
ENDC

IF !DEF(INTRO_FADEOUT_DMG_P3)
	DEF INTRO_FADEOUT_DMG_P3 EQU %11_10_01_00
ENDC

DEF LOGO_WIDTH           EQU 12

DEF INTRO_TOP_COUNT      EQU 10

FOR I, INTRO_TOP_COUNT
	DEF OBJ_INTRO_TOP_{d:I} EQU I
ENDR
DEF OBJ_INTRO_TOP_END    EQU OBJ_INTRO_TOP_9   +  1

DEF OBJ_INTRO_REG        EQU OBJ_INTRO_TOP_END

; Reuse since it never appears alongside the logo
DEF OBJ_INTRO_0          EQU OBJ_INTRO_TOP_END
FOR I, 1, 6
	DEF _ =(I-1)
	DEF OBJ_INTRO_{d:I}  EQU OBJ_INTRO_{d:_}   +  INTRO_{d:_}_WIDTH * 2
ENDR
DEF OBJ_INTRO_LOGO_END   EQU OBJ_INTRO_5       +  INTRO_5_WIDTH * 2

DEF OBJ_INTRO_META_END   EQU OBJ_INTRO_4

DEF OBJ_INTRO_END        EQU OBJ_INTRO_LOGO_END
